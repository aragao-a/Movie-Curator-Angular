<div class="listing listing--carousel">

  <div class="listing__head">

    <h2 class="listing__title">{{ title }}</h2>

    <div class="listing__actions">

      <select class="sort-select" (change)="onSortChange($event)">
        <option value="popularity">Mais Populares</option>
        <option value="vote">Melhor Nota</option>
        <option value="release_date">Mais Recentes</option>
        <option value="runtime">Duração</option>
        <option value="title">Nome (A-Z)</option>
      </select>

      <app-button 
        appearance="tertiary" 
        (click)="openFilterDialog()"
      >
        Filtros
      </app-button>

      <app-button
        *ngIf="isFiltered"
        appearance="fortiary"
        (click)="clearFilter()"
      >
        <img class="reset-icon" src="assets/vectors/history.svg" alt="Resetar Filtro">
      </app-button>

    </div>
  </div>

  @if (displayedItems.length > 0) {
    <div class="carousel">
      <button aria-label="Previous" type="button" [disabled]="!canNavigateLeft" (click)="prevSlide()" class="carousel__nav carousel__nav--left">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M17.9 23.2L6.1 12 17.9.8"></path>
        </svg>
      </button>

      <div class="carousel__items" #carouselContainer>
        @for (item of displayedItems; track item.id) {
          <div class="card">
            <div (click)="openSynopsisDialog(item)" class="card__link">
              <div class="card__img">
                @if (item.imgSrc) {
                  <img [src]="getPosterUrl(item.imgSrc)" [alt]="item.title || item.name" class="lazyload">
                } @else {
                  <span>
                    <svg></svg>
                  </span>
                }
              </div>
              @if (isDefaultCarousel) {
                <div>
                  <h2 class="card__name">{{ item.title }}</h2>
                  <p class="card__genres">{{ item.genres }}</p>
                  
                  <div class="final-line">
                    <div class="card__rating">
                      <div class="card__stars">
                        <div [style.width.%]="item.rating"></div>
                      </div>
                      <div class="card__vote">{{ item.vote | number:'1.1-2' }}</div>
                    </div>
                    <app-button
                      appearance="secondary"
                      (click)="onAddMovieToMarathon(item, $event)"
                      class="add-to-marathon-btn"
                    >
                      <img class="plus-icon" src="assets/vectors/circle-plus.svg" alt="Adicionar à Maratona">
                    </app-button>
                  </div>
                </div>
              }
              @if (isCastCarousel) {
                }
            </div>
          </div>
        }
      </div>

      <button aria-label="Next" type="button" [disabled]="!canNavigateRight" (click)="nextSlide()" class="carousel__nav carousel__nav--right">
        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
          <path fill="none" stroke="#fff" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" stroke-miterlimit="10" d="M6.1 23.2L17.9 12 6.1.8"></path>
        </svg>
      </button>
    </div>
  } @else {
    <div class="empty-carousel">
      <p>Ops, não encontramos nenhum filme com esses parâmetros :(</p>
    </div>
  }
</div>

<app-filter-dialog [genres]="genres" (applyFilter)="handleFilterApplied($event)"></app-filter-dialog>

<app-synopsis-dialog (addMovie)="handleAddMovieFromSynopsis($event)"></app-synopsis-dialog>